<ion-header>
  <app-header
    [title]="referralPageData?.referralPageTitle"
    [loading]="loading"
    (backAction)="goBack()"
    [backButtonLabel]="referralPageData?.referralBackButtonLabel || ''"
    (logoAction)="showRootPage()"
    [logoActionLabel]="referralPageData?.referralMainScreenButtonLabel || ''"
  ></app-header>
</ion-header>

<ion-content *ngIf="isSupportedRegion()" color="dark" class="ion-padding">
  <div *ngIf="!category">
    <div *ngIf="loading">
      <h2>
        <ion-skeleton-text
          animated
          class="skeleton-text--light"
          style="width: 25%; line-height: 1"
        ></ion-skeleton-text>
      </h2>
      <div class="ion-margin-vertical ion-padding-bottom">
        <br />
        <ion-skeleton-text
          animated
          class="skeleton-text--light"
          width="100%"
        ></ion-skeleton-text>
        <ion-skeleton-text
          animated
          class="skeleton-text--light"
          width="100%"
        ></ion-skeleton-text>
        <ion-skeleton-text
          animated
          class="skeleton-text--light"
          width="80%"
        ></ion-skeleton-text>
      </div>
    </div>
    <div *ngIf="!loading">
      <h2 class="ion-no-margin">{{ referralPageData.referralPageGreeting }}</h2>
      <div
        class="text-style--wrap-newlines ion-margin-vertical ion-padding-bottom"
      >
        <ion-text> {{ referralPageData.referralPageInstructions }} </ion-text>
      </div>
    </div>
  </div>
  <div *ngIf="!loading">
    <div>
      <div *ngIf="!category" class="ion-padding-bottom">
        <!-- Root/Main Category-list -->
        <ul class="list-flat tile-grid tile-grid_base-3 ion-margin-bottom">
          <li *ngFor="let categoryItem of categories" class="tile-grid--item">
            <link-tile
              [category]="categoryItem"
              [subCategory]="getNextSubCategory(categoryItem)"
            ></link-tile>
          </li>
        </ul>
        <br /><br /><br />
      </div>
      <div
        *ngIf="category && !subCategory"
        class="ion-margin-bottom ion-padding-bottom"
      >
        <h2 class="ion-no-margin text-style--header text-style--size-1">
          {{ category.categoryName }}
        </h2>
        <p *ngIf="category.categoryDescription">
          {{ category.categoryDescription }}
        </p>
      </div>
      <div *ngIf="category && !subCategory">
        <ul class="list-flat ion-margin-vertical">
          <li
            *ngFor="let subCategoryItem of subCategories | categoryFilter: category"
            class="ion-margin-bottom"
          >
            <sub-category
              [subCategory]="subCategoryItem"
              [category]="category"
            ></sub-category>
          </li>
        </ul>
      </div>
      <div
        *ngIf="category && subCategory"
        class="ion-margin-bottom ion-padding-bottom"
      >
        <h2 class="ion-no-margin text-style--header text-style--size-1">
          {{ subCategory.subCategoryName }}
        </h2>
        <p *ngIf="subCategory.subCategoryDescription">
          {{ subCategory.subCategoryDescription }}
        </p>
      </div>
    </div>
    <div *ngIf="category && subCategory && !offer">
      <offer
        *ngFor="let _offer of offers | categoryFilter: category | subCategoryFilter: subCategory"
        [offer]="_offer"
        [referralOfferButtonLabel]="referralPageData.referralOfferButtonLabel"
        (click)="clickOffer(_offer)"
        class="ion-margin-bottom"
      ></offer>

      <app-last-updated-time
        class="ion-margin-vertical"
      ></app-last-updated-time>
    </div>
    <div *ngIf="category && subCategory && offer">
      <offer
        [offer]="offer"
        [referralOfferButtonLabel]="referralPageData.referralOfferButtonLabel"
        [showDetails]="true"
        [goBack]="goBack.bind(this)"
        (click)="clickOffer(offer)"
      ></offer>

      <app-last-updated-time
        class="ion-margin-vertical"
      ></app-last-updated-time>
    </div>

    <div
      *ngIf="categories?.length === 0 || subCategories?.length === 0 || offers?.length === 0"
    >
      <ion-card class="referral-data-unavailable-card ion-text-center">
        <ion-card-header>
          <ion-card-subtitle>Data Unavailable</ion-card-subtitle>
        </ion-card-header>

        <ion-card-content>
          Please reach out to us at
          <a href="https://www.rodekruis.nl/">https://www.rodekruis.nl/</a>.
        </ion-card-content>
      </ion-card>
    </div>
  </div>
  <ion-spinner
    *ngIf="loading"
    name="crescent"
    color="light"
    class="ion-margin ion-padding"
  ></ion-spinner>
</ion-content>

<ion-content *ngIf="!isSupportedRegion()" color="dark" class="ion-padding">
  <div *ngIf="!category" class="ion-margin-bottom ion-padding-bottom">
    <h2 class="text-style--header text-style--size-1">{{ pageHeader }}</h2>
    <p class="text-style--wrap-newlines">{{ pageIntroduction }}</p>
  </div>
  <ul class="list-flat tile-grid tile-grid_base-2 ion-margin-vertical">
    <li *ngFor="let region of regions" class="tile-grid--item">
      <sheet
        [sheetName]="regionsLabels[regions.indexOf(region)]"
        [sheetUrl]="region"
      ></sheet>
    </li>
  </ul>
  <br /><br /><br />
</ion-content>

<ion-footer
  *ngIf="isSupportedRegion() && (!!referralPageData.referralPhoneNumber || !!referralPageData.referralWhatsAppLink)"
  color="secondary"
>
  <ion-toolbar>
    <ion-buttons slot="end">
      <ion-button
        *ngIf="referralPageData.referralPhoneNumber"
        [href]="'tel:' + referralPageData.referralPhoneNumber"
        target="_blank"
        rel="noopener"
        (click)="logContactClick('tel')"
      >
        <ion-icon slot="icon-only" name="call"></ion-icon>
      </ion-button>
      <ion-button
        *ngIf="referralPageData.referralWhatsAppLink"
        [href]="referralPageData.referralWhatsAppLink"
        target="_blank"
        rel="noopener"
        (click)="logContactClick('whatsapp')"
      >
        <ion-img
          class="button-icon--whatsapp-image"
          src="assets/icons/whatsapp.png"
          alt="WhatsApp"
          loading="lazy"
        ></ion-img>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
